---
title: Arquitectura T√©cnica
description: Stack tecnol√≥gico y configuraci√≥n de seguridad (OAuth).
sidebar:
  order: 3
---

Documentaci√≥n t√©cnica sobre c√≥mo est√° construido, desplegado y gestionado este sitio (`docs.herwingx.dev`).

## üõ†Ô∏è Stack Tecnol√≥gico

| Componente | Tecnolog√≠a | Prop√≥sito |
|:-----------|:-----------|:----------|
| **Core** | [Astro](https://astro.build) v5 | Framework web est√°tico de alto rendimiento. |
| **Tema** | [Starlight](https://starlight.astro.build) | Plantilla de documentaci√≥n optimizada. |
| **CMS** | [Sveltia CMS](https://github.com/sveltia/sveltia-cms) | Editor visual de contenido (Git-based). |
| **Hosting** | [GitHub Pages](https://pages.github.com) | Alojamiento gratuito y r√°pido para sitios est√°ticos. |
| **Auth** | [Cloudflare Workers](https://workers.cloudflare.com) | Proxy Serverless para autenticaci√≥n OAuth segura. |
| **Dominio** | [Cloudflare DNS](https://dash.cloudflare.com) | Gesti√≥n de DNS y SSL. |

---

## üöÄ Flujo de Despliegue (CI/CD)

El sitio utiliza **GitHub Actions** para construir y desplegar autom√°ticamente cada vez que hay cambios en la rama `main`.

```mermaid
graph LR
    A[‚úçÔ∏è Editor/CMS] -->|Commit & Push| B(GitHub Repo)
    B -->|Trigger| C{GitHub Actions}
    C -->|npm run build| D[Build Est√°tico]
    D -->|Deploy| E[GitHub Pages]
    E -->|Servir| F[üåê docs.herwingx.dev]
```

1. **Commit**: Se detecta un cambio en `main` (ya sea por push manual o desde el CMS).
2. **Build**: GitHub Actions instala dependencias y ejecuta `npm run build`.
3. **Deploy**: Los archivos generados en `dist/` se suben a GitHub Pages.

---

## üîê Autenticaci√≥n del CMS (OAuth)

Para que el CMS pueda escribir en el repositorio, necesita un **token de acceso** de usuario. GitHub requiere un intercambio seguro de credenciales que no puede hacerse desde un sitio est√°tico (frontend). Usamos un **Cloudflare Worker** como intermediario seguro.

### Diagrama de Secuencia

```mermaid
sequenceDiagram
    participant User as üë§ Usuario
    participant CMS as üñ•Ô∏è Sveltia CMS
    participant GH as üêô GitHub
    participant Worker as ‚òÅÔ∏è Cloudflare Worker

    User->>CMS: Click "Login with GitHub"
    CMS->>GH: Redirige a GitHub (Authorize)
    User->>GH: Acepta permisos
    GH->>CMS: Redirige con "Code" temporal
    CMS->>Worker: Env√≠a Code
    Note over Worker: Tiene el CLIENT_SECRET üîí
    Worker->>GH: Intercambia Code por Token
    GH->>Worker: Responde Access Token
    Worker->>CMS: Entrega Token al CMS
    CMS->>GH: Usa Token para leer/escribir repo
```

### Configuraci√≥n de Seguridad

#### 1. GitHub OAuth App
- **Ubicaci√≥n**: GitHub Settings > Developer Settings > OAuth Apps.
- **Configuraci√≥n clave**:
  - `Homepage URL`: `https://docs.herwingx.dev`
  - `Callback URL`: `https://docs-oauth.herwingx.workers.dev/callback` (apunta al worker).

#### 2. Cloudflare Worker (`docs-oauth`)
Es un script serverless simple que act√∫a como "puente".
- **C√≥digo**: Recibe el `code` del CMS y pide el token a GitHub.
- **Secretos**: El `CLIENT_SECRET` de GitHub est√° almacenado aqu√≠. **NUNCA** debe estar en el c√≥digo del frontend.

---

## üõ°Ô∏è Gu√≠a de Seguridad (Qu√© NO tocar)

1. **Client Secret**: Jam√°s lo pongas en `astro.config.mjs` o `config.yml`. Solo debe existir en el c√≥digo del Worker.
2. **Worker URL**: Puedes cambiarla en `public/admin/config.yml` si creas un nuevo worker.
3. **Repo Privado (Opcional)**: Si decides hacer el repo privado, el flujo sigue funcionando, pero necesitar√°s pagar GitHub Pro para usar Pages en repos privados o usar otro host como Vercel/Netlify.

---

## üìù Gesti√≥n de Contenido

### V√≠a Panel Admin (Recomendado)
Visita `/admin/` para usar la interfaz visual.
- **Im√°genes**: Se suben autom√°ticamente a `src/assets/images`.
- **Frontmatter**: El CMS gestiona los metadatos (t√≠tulo, orden, badges) autom√°ticamente.

### V√≠a C√≥digo (VS Code)
Puedes editar directamente los archivos `.mdx` en `src/content/docs/`.
```mdx
---
title: Mi T√≠tulo
description: Descripci√≥n SEO
sidebar:
  order: 1
---

# Contenido
```
